import type { NextApiRequest, NextApiResponse } from 'next'
import axios from 'axios'

const slackWebhook = process.env.SLACK_WEBHOOK_URL as string

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (!slackWebhook) return res.status(500).json({ error: 'Slack webhook not set' })

  const { safeAddress, proposalType, txHash } = req.body

  try {
    const payload = {
      text: `ğŸ” *New Proposal Submitted*\nğŸ“¬ Type: ${proposalType}\nğŸ¦ Safe: \`${safeAddress}\`\nğŸ“¦ Tx Hash: \`${txHash || 'Pending...'}\``
    }

    await axios.post(slackWebhook, payload)
    res.status(200).json({ ok: true })
  } catch (err) {
    console.error(err)
    res.status(500).json({ error: 'Slack notification failed' })
  }
}
